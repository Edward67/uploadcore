<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <title>UXcore UploadCore</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="images/favicon.png" type="image/x-icon" />
        <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon" />
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/github.min.css"/>
        <link rel="stylesheet" href="stylesheets/normalize.css" />
        <link rel="stylesheet" href="stylesheets/stylesheet.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
        <script src="lib/jquery/jquery.min.js"></script>
        <script src="lib/spark-md5/spark-md5.min.js"></script>
        <script src="lib/es5-shim/es5-shim.min.js"></script>
        <script src="lib/es5-shim/es5-sham.min.js"></script>
        <script src="lib/uxcore-uploadcore/uploadcore.js"></script>
    </head>
    <body>
        <section class="page-header">
            <h1 class="project-name">uxcore-uploadcore</h1>

            <h2 class="project-tagline">Uxcore UploadCore</h2>
            <a href="https://github.com/uxcore/uxcore-uploadcore" class="btn">View on GitHub</a>
            <a href="https://github.com/uxcore/uxcore-uploadcore/zipball/master" class="btn">Download .zip</a>
            <a href="https://github.com/uxcore/uxcore-uploadcore/tarball/master" class="btn">Download .tar.gz</a>
        </section>

        <section class="main-content">

            <p><strong>安装</strong></p>

<pre><code class="shell">npm install uxcore-uploadcore</code></pre>

            <p><strong>引入依赖库</strong></p>

<pre><code class="html">&lt;!--required--&gt;
&lt;script src="path/to/jquery.js"&gt;&lt;/script&gt;
&lt;!--optional--&gt;
&lt;script src="path/to/spark-md5.js"&gt;&lt;/script&gt;
&lt;script src="path/to/es5-shim/es5-shim.min.js"&gt;&lt;/script&gt;
&lt;script src="path/to/es5-shim/es5-sham.min.js"&gt;&lt;/script&gt;</code></pre>

            <p><strong>导入资源</strong></p>

            <pre><code class="javascript">import {UploadCore, Events, Status} from 'uxcore-uploadcore';</code></pre>

            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample1 - 一个上传按钮</h3>

            <div class="sample">
                <div class="upload" id="clickarea">
                    <button><i class="uxicon icon-upload"></i>点击上传</button>
                </div>

                <div class="console" id="console1"></div>
            </div>

<pre><code class="javascript">const up = new UploadCore({
    name: 'file',
    url: 'http://test.yanbingbing.com/upload.php',
    autoPending: true
});

// 事件监听
up.on(Events.FILE_UPLOAD_COMPLETED, (file) => {
    if (file.getStatus() === Status.SUCCESS) {
        alert('上传成功');
        console.info(file.response.getJson());
    } else {
        alert('上传失败');
    }
});

// 添加触发区域
const picker = up.getPickerCollector();
picker.addArea(document.getElementById('clickarea'));</code>
</pre>

            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample2 - 粘贴上传</h3>

            <div class="sample">
                <textarea id="pastearea" placeholder="粘贴文件上传"></textarea>

                <div class="console" id="console2"></div>
            </div>
<pre><code class="javascript">const paster = up.getPasteCollector();

paster.addArea(document.getElementById('pastearea'));</code></pre>

            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample3 - 多触发区域</h3>

            <div class="sample">
                <div class="upload" id="clickarea1">
                    <button><i class="uxicon icon-upload"></i>点击上传</button>
                </div>
                <div class="upload" id="clickarea2">
                    <button><i class="uxicon icon-upload"></i>点击上传</button>
                </div>

                <div class="console" id="console3"></div>
            </div>

<pre><code class="javascript">const picker = up.getPickerCollector();

// 添加点击触发区域1
picker.addArea(document.getElementById('clickarea1'));
// 添加点击触发区域2
picker.addArea(document.getElementById('clickarea2'));</code></pre>

            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample4 - 拖拽上传</h3>

            <div class="sample">
                <div class="droparea" id="droparea">
                    <p><i class="uxicon icon-upload2"></i></p>
                    <p>拖拽文件到此区域</p>
                </div>

                <div class="console" id="console4"></div>
            </div>

<pre><code class="javascript">const $area = jQuery('#droparea');
const dndArea = up.getDndCollector().addArea($area[0]);

dndArea.on('start', () => {
    // 拖拽开始
    $area.addClass('blink');
}).on('response', (e) => {
    // 拖拽响应
    if ($area[0].contains(e.target)) {
        $area.addClass('enter');
    } else {
        $area.removeClass('enter');
    }
}).on('end', () => {
    // 拖拽结束
    $area.removeClass('enter blink');
});</code></pre>

            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample5 - 上传准备时：获取token</h3>

            <div class="sample">
                <div class="upload" id="clickarea3">
                    <button><i class="uxicon icon-upload"></i>点击上传</button>
                </div>
                <div class="console" id="console5"></div>
            </div>

<pre><code class="javascript">up.on(Events.FILE_UPLOAD_PREPARING, (request) => {
    const i = jQuery.Defferd();
    // 请求token
    jQuery.getJSON("http://test.yanbingbing.com/token.php", (json) => {
        // 设置文件请求参数token
        request.setParam('token', json.token);
        i.resolve();
    });
    return i;
});</code></pre>


            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample6 - 秒传</h3>

            <div class="sample">
                <div class="upload" id="clickarea4">
                    <button><i class="uxicon icon-upload"></i>点击上传</button>
                </div>
                <div class="console" id="console6"></div>
            </div>

            <pre><code class="javascript">up.on(Events.FILE_UPLOAD_PREPARING, (request) => {
    const file = request.getFile();
    // md5 start
    file.md5().done((md5) => {
        // 用md5值去服务端查询是否存在文件
        jQuery.getJSON('http://test.yanbingbing.com/head.php', {md5:md5}).done((ret) => {
            if (ret.code === 0 && ret.data) {
                // 存在文件, 以响应的数据ret直接完成上传
                file.complete(ret);
            }
        });
    });
});</code></pre>

            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample7 - 分片上传</h3>

            <div class="sample">
                <div class="upload" id="clickarea5">
                    <button><i class="uxicon icon-upload"></i>点击上传</button>
                </div>
                <div class="console" id="console7"></div>
            </div>

            <pre><code class="javascript">const up = new UploadCore({
    name: 'file',
    url: 'http://test.yanbingbing.com/upload.php',
    chunkSize: '400k', // 400k
    chunkEnable: true,
    chunkProcessThreads: 2,
    autoPending: true
});

// 文件上传请求准备时
up.on(Events.FILE_UPLOAD_PREPARING, (request) => {
    if (request.isChunkEnable()) {
        const i = jQuery.Deferred(),
            file = request.getFile(),
            chunkSize = request.getChunkSize();
        // 改变请求地址
        request.setUrl('http://test.yanbingbing.com/chunk.php');
        // 创建上传事务
        jQuery.getJSON('http://test.yanbingbing.com/transaction.php', {
            size: file.size,
            ext: file.ext,
            chunkTotal: Math.ceil(file.size / chunkSize)
        }).done((ret) => {
            // 设置事务ID
            request.setParam('transId', ret.data.transId);
            i.resolve();
        });

        return i;
    }
})
// 分块上传请求准备时
.on(Events.CHUNK_UPLOAD_PREPARING, (request) => {
    if (request.isMultiChunk()) {
        const params = request.getParams();
        const transId = request.getParam('transId', true);
        // 设置分块上传请求序号
        request.setParam('sequence', request.getIndex() + 1);
    }
})
// 文件上传完成时
.on(Events.FILE_UPLOAD_COMPLETING, (response) => {
    if (response.isFromMultiChunkResponse()) {
        const i = jQuery.Deferred();
        const params = response.getFileRequest().getParams();
        const transId = params.getParam('transId', true);
        // 请求完成事务
        jQuery.post('http://test.yanbingbing.com/transaction.php?transId='+ transId).done((ret) => {
            // 设置上传完成响应数据
            response.setResponse(ret);
            i.resolve();
        });
        return i;
    }
});
</code></pre>



            <h3><a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample8 - 事件监听</h3>

            <div class="sample">
                <div class="upload" id="clickarea6">
                    <button><i class="uxicon icon-upload"></i>点击上传</button>
                </div>
                <div class="console" id="console8"></div>
            </div>

        <pre><code class="javascript">// 队列上传开始
up.on(Events.QUEUE_UPLOAD_START, () => {
    console.info(Events.QUEUE_UPLOAD_START);
})
// 队列上传结束
.on(Events.QUEUE_UPLOAD_END, () => {
    console.info(Events.QUEUE_UPLOAD_END);
})
// 队列错误
.on(Events.QUEUE_ERROR, (error) => {
    console.info(Events.QUEUE_ERROR, error);
})
// 队列添加
.on(Events.QUEUE_FILE_ADDED, (file) => {
    console.info(Events.QUEUE_ERROR, file);
})
// 文件被过滤
.on(Events.QUEUE_FILE_FILTERED, (file, error) => {
    console.info(Events.QUEUE_FILE_FILTERED, file, error);
})
// 队列统计变化
.on(Events.QUEUE_STAT_CHANGE, (stat) => {
    console.info(Events.QUEUE_STAT_CHANGE, stat.stat());
})
// 文件上传开始
.on(Events.FILE_UPLOAD_START, (file) => {
    console.info(Events.FILE_UPLOAD_START, file);
})
// 文件上传准备中
.on(Events.FILE_UPLOAD_PREPARING, (request) => {
    console.info(Events.FILE_UPLOAD_PREPARING, request);
})
// 文件上传准备完毕
.on(Events.FILE_UPLOAD_PREPARED, (file) => {
    console.info(Events.FILE_UPLOAD_PREPARED, file);
})
// 文件块上传准备中
.on(Events.CHUNK_UPLOAD_PREPARING, (request) => {
    console.info(Events.CHUNK_UPLOAD_PREPARING, request);
})
// 文件块上传完成中
.on(Events.CHUNK_UPLOAD_COMPLETING, (response) => {
    console.info(Events.CHUNK_UPLOAD_COMPLETING, response);
})
// 文件上传进度
.on(Events.FILE_UPLOAD_PROGRESS, (file, progress) => {
    console.info(Events.FILE_UPLOAD_PROGRESS, file, progress);
})
// 文件上传结束
.on(Events.FILE_UPLOAD_END, (file) => {
    console.info(Events.FILE_UPLOAD_END, file);
})
// 文件上传完成中
.on(Events.FILE_UPLOAD_COMPLETING, (response) => {
    console.info(Events.FILE_UPLOAD_COMPLETING, response);
})
// 文件上传成功
.on(Events.FILE_UPLOAD_SUCCESS, (file, response) => {
    console.info(Events.FILE_UPLOAD_SUCCESS, file, response);
})
// 文件上传错误
.on(Events.FILE_UPLOAD_ERROR, (file, error) => {
    console.info(Events.FILE_UPLOAD_ERROR, file, error);
})
// 文件上传完成
.on(Events.FILE_UPLOAD_COMPLETED, (file, status) => {
    console.info(Events.FILE_UPLOAD_COMPLETED, file, status);
})
// 文件取消
.on(Events.FILE_CANCEL, (file) => {
    console.info(Events.FILE_CANCEL, file);
})
// 文件状态变化
.on(Events.FILE_STATUS_CHANGE, (file, status) => {
    console.info(Events.FILE_STATUS_CHANGE, file, status);
});</code></pre>


            <footer class="site-footer">
                <span class="site-footer-owner"><a href="https://github.com/uxcore/uxcore-uploadcore">uxcore-uploadcore</a> is maintained by <a
                        href="https://github.com/uxcore">uxcore</a>.</span>

                <span class="site-footer-credits">This page using the <a
                        href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a
                        href="https://twitter.com/jasonlong">Jason Long</a>.</span>
            </footer>

        </section>



<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="index.js"></script>
</body>
</html>
