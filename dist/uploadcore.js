!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.UploadCore=t():e.UploadCore=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=r(i),u=n(3),a=r(u),s=n(4),l=r(s);t["default"]=o["default"],t.UploadCore=o["default"],t.Events=a["default"],t.Status=l["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=u,r=!0}},s=n(2),l=r(s),c=n(3),f=r(c),h=n(4),p=r(h),d=n(5),v=n(6),y=n(7),m=r(y),g=n(8),k=r(g),b=n(13),E=r(b),w=n(14),_=r(w),O=["name","url","params","action","data","headers","withCredentials","timeout","chunkEnable","chunkSize","chunkRetries","chunkProcessThreads"],P=function(e){function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.autoPending=n.autoPending||n.auto,this.capcity=n.capcity||n.queueCapcity||0,this.multiple=null==n.multiple?!0:n.multiple,this.accept=v.normalizeAccept(n.accept),this.sizeLimit=v.parseSize(n.sizeLimit||n.fileSizeLimit||0),this.pending=new T(n.processThreads),this.stat=new R,this.constraints=new C,this.filters=new S,this.multiple||(this.capcity=1),this.capcity>0&&this.addConstraint(function(){return e.stat.getTotal()>=e.capcity}),this.accept&&this.accept.length>0&&this.addFilter(function(t){return e.accept.some(function(e){return e.extensions&&e.extensions.indexOf(t.ext)>-1})?void 0:new d.FileExtensionError(t,'extension "'+t.ext+'" is not allowed')}),this.sizeLimit>0&&this.addFilter(function(t){return t.size>e.sizeLimit?new d.FileSizeError(t,"filesize:"+v.formatSize(t.size)+" is greater than limit:"+v.formatSize(e.sizeLimit)):void 0}),n.preventDuplicate&&this.addFilter(function(t){return e.stat.getFiles().some(function(e){return e.name===t.name&&e.size===t.size})?new d.DuplicateError(t,'file "'+t.name+'" already in queue'):void 0}),Array.isArray(n.filters)&&n.fitlers.forEach(function(t){return e.addFilter(t)});var r=n.request||{};O.forEach(function(e){n.hasOwnProperty(e)&&(r[e]=n[e])}),this.requestOptions=r}return o(t,e),u(t,[{key:"createFileRequest",value:function(e){return new m["default"](e,this.requestOptions)}},{key:"isLimit",value:function(){return this.constraints.some()}},{key:"addConstraint",value:function(e){return this.constraints.add(e)}},{key:"addFilter",value:function(e){return this.filters.add(e)}},{key:"add",value:function(e){var t=this;if(this.isLimit())return this.emit(f["default"].QUEUE_ERROR,new d.QueueLimitError),-1;var n=this.filters.filter(e);return n||this.stat.add(e)||(n=new d.DuplicateError(e,'file "'+e.name+'" already in queue')),n?(this.emit(f["default"].QUEUE_FILE_FILTERED,e,n),this.emit(f["default"].QUEUE_ERROR,n),0):(e.setStatus(p["default"].QUEUED),e.on(f["default"].FILE_STATUS_CHANGE,function(n){n===p["default"].CANCELLED?t.stat.remove(e):n===p["default"].PENDING&&setTimeout(function(){t.pending.add(e)&&1===t.pending.size()&&t.emit(f["default"].QUEUE_UPLOAD_START)},1),t.emit(f["default"].QUEUE_STAT_CHANGE,t.stat),t.stat.getFiles(p["default"].PROCESS).length<1&&t.emit(f["default"].QUEUE_UPLOAD_END)}),e.setCore(this),this.emit(f["default"].QUEUE_FILE_ADDED,e),this.emit(f["default"].QUEUE_STAT_CHANGE,this.stat),this.autoPending&&e.pending(),1)}},{key:"isMultiple",value:function(){return this.multiple}},{key:"isFull",value:function(){return this.capcity>0&&this.getTotal()>=this.capcity}},{key:"isEmpty",value:function(){return this.getTotal()<1}},{key:"getAccept",value:function(){return this.accept}},{key:"getStat",value:function(){return this.stat}},{key:"getTotal",value:function(){return this.getStat().getTotal()}},{key:"getFiles",value:function(e){return this.getStat().getFiles(e)}},{key:"stat",value:function(e){return this.getStat().stat(e)}},{key:"getPickerCollector",value:function(){return this.picker||(this.picker=new _["default"](this)),this.picker}},{key:"getDndCollector",value:function(){return this.dnd||(this.dnd=new k["default"](this)),this.dnd}},{key:"getPasteCollector",value:function(){return this.paster||(this.paster=new E["default"](this)),this.paster}}],[{key:"setSWF",value:function(e){_["default"].setSWF(e)}}]),t}(l["default"]);t["default"]=P;var j=function(){function e(){i(this,e),this._set=[]}return u(e,[{key:"size",value:function(){return this._set.length}},{key:"shift",value:function(){return this._set.shift()}},{key:"pop",value:function(){return this._set.pop()}},{key:"toArray",value:function(){return this._set.slice(0)}},{key:"add",value:function(e){return this.has(e)?!1:(this._set.push(e),!0)}},{key:"has",value:function(e){return this._set.indexOf(e)>-1}},{key:"remove",value:function(e){var t=this._set.indexOf(e);return t>-1?(this._set.splice(t,1),!0):!1}},{key:"clear",value:function(){this._set=[]}}]),e}(),R=function(){function e(){i(this,e),this.files=new j}return u(e,[{key:"add",value:function(e){return this.files.add(e)}},{key:"remove",value:function(e){this.files.remove(e)}},{key:"getTotal",value:function(){return this.files.size()}},{key:"getFiles",value:function(e){var t=this.files.toArray();return e?t.filter(function(t){return!!(t.getStatus()&e)}):t}},{key:"stat",value:function t(e){var t={},n=this.getFiles(e);return n.forEach(function(e){var n=e.getStatus();t[n]=n in t?t[n]+1:1}),t.sum=n.length,t}}]),e}(),C=function(){function e(){i(this,e),this.constraints=new j}return u(e,[{key:"add",value:function(e){return this.constraints.add(e),this}},{key:"remove",value:function(e){return this.constraints.remove(e),this}},{key:"some",value:function(){var e=this;return this.constraints.toArray().some(function(t){return t.call(e)})}}]),e}(),S=function(){function e(){i(this,e),this.filters=new j}return u(e,[{key:"add",value:function(e){return this.filters.add(e),this}},{key:"remove",value:function(e){return this.filters.remove(e),this}},{key:"filter",value:function(e){var t=null;return this.filters.toArray().every(function(n){var r=void 0;try{r=n(e)}catch(i){r=i}return"string"==typeof r?(t=new d.FilterError(e,r),!1):r instanceof Error?(t=r instanceof d.FilterError?r:new d.FilterError(e,r.toString()),!1):!0}),t}}]),e}(),T=function(){function e(t){i(this,e),this.threads=t||2,this.heading=new j,this.pending=new j}return u(e,[{key:"add",value:function(e){var t=this;return this.pending.add(e)?(e.session().always(function(){return t.pending.remove(e)}),this.load(),!0):!1}},{key:"size",value:function(){return this.pending.size()+this.heading.size()}},{key:"process",value:function(e){var t=this;this.heading.add(e)&&e.session().always(function(){t.heading.remove(e),t.load()})}},{key:"load",value:function(){for(var e;this.heading.size()<this.threads&&(e=this.pending.shift());)e.prepare()&&this.process(e)}}]),e}();e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){var r=t,i=null,o=void 0,u=jQuery.Deferred(),a=u.promise();a.abort=function(){o=!0};var s=function(e){o||(e&&(i=e instanceof Error?e:new Error(e)),u.reject(i||new Error("Unknown")))},l=function(){o||(null!=i?s():u.resolve(r))},c=function(e){null==e||null!=r&&e.constructor!==r.constructor||(r=e)},f=function h(t){if(!o){if(t instanceof Error&&(i=t),null!=i)return s();c(t);var u=e.shift();if(!u)return l();var a=void 0;try{a=u.call(n,r)}catch(f){return s(f)}a&&a.then?a.then(h,s):h(a)}};return setTimeout(f,1),a}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e)}return i(e,[{key:"on",value:function(e,t){return e=e.toLowerCase(),this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(t),this}},{key:"once",value:function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}e=e.toLowerCase();var r=this;return n.listener=t,this.on(e,n),this}},{key:"off",value:function(e,t){e=e.toLowerCase();var n=void 0;if(!this._events||!(n=this._events[e]))return this;for(var r=n.length;r-->0;)if(n[r]===t||n[r].listener===t){n.splice(r,1);break}return 0===n.length&&delete this._events[e],this}},{key:"removeAllListeners",value:function(e){return e?delete this._events[e.toLowerCase()]:this._events=[],this}},{key:"setPropagationTarget",value:function(t){t instanceof e&&(this.propagationTarget=t)}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this.applyEmit(e,n),this}},{key:"applyEmit",value:function(e,t){var n=this;e=e.toLowerCase();var r=void 0;if(this._events&&(r=this._events[e])&&r.slice(0).forEach(function(e){return e.apply(n,t)}),this.propagationTarget){var i=t.slice(0);i.unshift(this),this.propagationTarget.applyEmit(e,i)}return this}},{key:"invoke",value:function(e,t){e=e.toLowerCase();var n=void 0;return this._events&&(n=this._events[e])||(n=[]),r(n.slice(0),t,this)}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={QUEUE_UPLOAD_START:"queueuploadstart",QUEUE_UPLOAD_END:"queueuploadend",QUEUE_FILE_ADDED:"queuefileadded",QUEUE_FILE_FILTERED:"queuefilefiltered",QUEUE_ERROR:"queueerror",QUEUE_STAT_CHANGE:"statchange",FILE_UPLOAD_START:"fileuploadstart",FILE_UPLOAD_PREPARING:"fileuploadpreparing",FILE_UPLOAD_PREPARED:"fileuploadprepared",CHUNK_UPLOAD_PREPARING:"chunkuploadpreparing",CHUNK_UPLOAD_COMPLETING:"chunkuploadcompleting",FILE_UPLOAD_PROGRESS:"fileuploadprogress",FILE_UPLOAD_END:"fileuploadend",FILE_UPLOAD_COMPLETING:"fileuploadcompleting",FILE_UPLOAD_SUCCESS:"fileuploadsuccess",FILE_UPLOAD_ERROR:"fileuploaderror",FILE_UPLOAD_COMPLETED:"fileuploadcompleted",FILE_CANCEL:"filecancel",FILE_STATUS_CHANGE:"filestatuschange"},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={ALL:255,PROCESS:31,INITED:1,QUEUED:2,PENDING:4,PROGRESS:8,END:16,SUCCESS:32,ERROR:64,CANCELLED:128};var n={1:"inited",2:"queued",4:"pending",8:"progress",16:"end",32:"success",64:"error",128:"cancelled"};t.StatusName=n},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=u,r=!0}},o=function(e){function t(e){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.message=e}return r(t,e),t}(Error),u=function(e){function t(e){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.name="AbortError"}return r(t,e),t}(o);t.AbortError=u;var a=function(e){function t(e){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.name="TimeoutError"}return r(t,e),t}(o);t.TimeoutError=a;var s=function(e){function t(e,r){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,r),this.name="NetworkError",this.status=e}return r(t,e),t}(o);t.NetworkError=s;var l=function(e){function t(){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"queue limit"),this.name="QueueLimitError"}return r(t,e),t}(o);t.QueueLimitError=l;var c=function(e){function t(e,r){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,r),this.name="FilterError",this.file=e}return r(t,e),t}(o);t.FilterError=c;var f=function(e){function t(e,r){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r),this.name="DuplicateError"}return r(t,e),t}(c);t.DuplicateError=f;var h=function(e){function t(e,r){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r),this.name="FileExtensionError"}return r(t,e),t}(c);t.FileExtensionError=h;var p=function(e){function t(e,r){n(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r),this.name="FileSizeError"}return r(t,e),t}(c);t.FileSizeError=p},function(e,t){"use strict";function n(e){e=parseFloat(e);var t=["","K","M","G","T","P","E","Z","Y"],n=1024,r=e?Math.floor(Math.log(e)/Math.log(n)):0;r=Math.min(r,t.length-1);var i=Math.pow(10,2>r?0:r>2?2:1);return e/=Math.pow(n,r),e=Math.round(e*i)/i,e+t[r]+"B"}function r(e){if("string"!=typeof e)return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024};e=/^([0-9\.]+)([tgmk]?)b?$/i.exec(e);var n=e[2];return e=+e[1],t.hasOwnProperty(n)&&(e*=t[n]),e}function i(e){return"string"!=typeof e?"":e.toLowerCase().split(/ *[ ,;|+] */).map(function(e){var t=/^\*?\.?(\w+)$/.exec(e);return t?t[1]:null}).filter(function(e){return null!==e})}function o(e){return e?(Array.isArray(e)||(e=[e]),e.map(function(e){if("string"==typeof e&&(e=e.toLowerCase())&&u.hasOwnProperty(e))return u[e];var t=i(e.extensions||e);return t.length?{title:e.title||"",extensions:t,mimeTypes:e.mimeTypes||""}:null}).filter(function(e){return null!==e})):null}Object.defineProperty(t,"__esModule",{value:!0}),t.formatSize=n,t.parseSize=r,t.normalizeAccept=o;var u={images:{title:"Images",extensions:["jpg","jpeg","gif","png","bmp","svg","tiff","tif","ico","jpe","svgz","pct","psp","ai","psd","raw","webp"]},audios:{title:"Audios",extensions:["aac","aif","flac","iff","m4a","m4b","mid","midi","mp3","mpa","mpc","oga","ogg","ra","ram","snd","wav","wma"]},videos:{title:"Videos",extensions:["avi","divx","flv","m4v","mkv","mov","mp4","mpeg","mpg","ogm","ogv","ogx","rm","rmvb","smil","webm","wmv","xvid"]}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),u=function(){function e(t,n){r(this,e),this.rawResponse=t,this.chunkRequest=n}return i(e,[{key:"getChunkRequest",value:function(){return this.chunkRequest}},{key:"getRawResponse",value:function(){return this.rawResponse}},{key:"getResponse",value:function(){return this.response||this.rawResponse}},{key:"getJson",value:function(){var e=this.getResponse();return null==e?null:"function"==typeof e.getJson?e.getJson():"string"==typeof e?""===e?null:JSON.parse(e):e}},{key:"setResponse",value:function(e){return this.response=e,this}}]),e}(),a=function(){function e(t,n,i){r(this,e),this.index=t,this.blob=n,this.fileRequest=i}return i(e,[{key:"getName",value:function(){return this.fileRequest.getName()}},{key:"getFile",value:function(){return this.fileRequest.getFile()}},{key:"getBlob",value:function(){return this.blob}},{key:"getIndex",value:function(){return this.index}},{key:"isMultiChunk",value:function(){return this.getFile().source!==this.blob}},{key:"getParams",value:function(){return this.params||(this.params=this.fileRequest.getParams().clone()),this.params}},{key:"getParam",value:function(e){return this.getParams().getParam(e)}},{key:"setParam",value:function(e,t){return this.getParams().setParam(e,t),this}},{key:"getFileRequest",value:function(){return this.fileRequest}},{key:"getUrl",value:function(){return this.url||this.fileRequest.getUrl()}},{key:"setUrl",value:function(e){return this.url=e,this}},{key:"getHeaders",value:function(){return this.headers||(this.headers=this.fileRequest.getHeaders().slice(0)),this.headers}},{key:"setHeader",value:function(e,t){var n=this.getHeaders();return n.push({name:e,value:t}),this}},{key:"isWithCredentials",value:function(){return this.fileRequest.isWithCredentials()}},{key:"getTimeout",value:function(){return this.fileRequest.getTimeout()}},{key:"createChunkResponse",value:function(e){return new u(e,this)}}]),e}(),s=function(){function e(t,n){r(this,e),this.rawResponse=t,this.fileRequest=n}return i(e,[{key:"isFromMultiChunkResponse",value:function(){return this.rawResponse instanceof u?this.rawResponse.getChunkRequest().isMultiChunk():!1}},{key:"getFileRequest",value:function(){return this.fileRequest}},{key:"getRawResponse",value:function(){return this.rawResponse}},{key:"getResponse",value:function(){return null!=this.response?this.response:this.rawResponse instanceof u?this.rawResponse.getResponse():this.rawResponse}},{key:"getJson",value:function(){var e=this.getResponse();return null==e?null:"function"==typeof e.getJson?e.getJson():"string"==typeof e?""===e?null:JSON.parse(e):e}},{key:"setResponse",value:function(e){return this.response=e,this}}]),e}(),l=function(){function e(t){if(r(this,e),Array.isArray(t))this.params=t.slice(0);else if("object"==typeof t){this.params=[];for(var n in t)t.hasOwnProperty(n)&&this.params.push({name:n,value:t[n]})}else this.params=[]}return i(e,[{key:"setParam",value:function(e,t){this.removeParam(e),this.addParam(e,t)}},{key:"addParam",value:function(e,t){this.params.push({name:e,value:t})}},{key:"removeParam",value:function(e){this.params=this.params.filter(function(t){return t.name!==e})}},{key:"getParam",value:function(e,t){var n=this.params.filter(function(t){return t.name===e}).map(function(e){return e.value});return t?n.shift():n}},{key:"clone",value:function(){return new e(this.params)}},{key:"toArray",value:function(){return this.params}},{key:"toString",value:function(){var e=this.params.map(function(e){return encodeURIComponent(e.name)+"="+(null==e.value?"":encodeURIComponent(e.value))});return e.join("&")}}]),e}(),c=262144,f=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,e),this.file=t,this.name=n.name||"file",this.url=n.url||n.action,this.params=new l(n.params||n.data),this.headers=n.headers||[],this.withCredentials=n.withCredentials,this.timeout=n.timeout||0,this.chunkSize=n.chunkSize||0,this.chunkRetries=n.chunkRetries||0,this.chunkEnable=n.chunkEnable||!1,this.chunkProcessThreads=n.chunkProcessThreads||2}return i(e,[{key:"getFile",value:function(){return this.file}},{key:"getUrl",value:function(){return this.url||""}},{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){return this.name=e,this}},{key:"setUrl",value:function(e){return this.url=e,this}},{key:"getParams",value:function(){return this.params}},{key:"getParam",value:function(e){return this.getParams().getParam(e)}},{key:"setParam",value:function(e,t){return this.params.setParam(e,t),this}},{key:"getHeaders",value:function(){return this.headers}},{key:"setHeader",value:function(e,t){this.headers.push({name:e,value:t})}},{key:"isWithCredentials",value:function(){return this.withCredentials}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"getTimeout",value:function(){return this.timeout}},{key:"setTimeout",value:function(e){return this.timeout=e,this}},{key:"getChunkSize",value:function(){return o.parseSize(this.chunkSize)}},{key:"setChunkSize",value:function(e){return this.chunkSize=e,this}},{key:"getChunkRetries",value:function(){return this.chunkRetries}},{key:"setChunkRetries",value:function(e){return this.chunkRetries=e,0}},{key:"isChunkEnable",value:function(){var e=this.getChunkSize();return this.chunkEnable&&e>c&&this.file.getRuntime().canSlice()&&this.file.size>e}},{key:"setChunkEnable",value:function(e){return this.chunkEnable=e,this}},{key:"getChunkProcessThreads",value:function(){return this.chunkProcessThreads}},{key:"setChunkProcessThreads",value:function(e){return this.chunkProcessThreads=e,this}},{key:"createChunkRequest",value:function(e,t){return new a(e,t,this)}},{key:"createFileResponse",value:function(e){return new s(e,this)}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return function(t,n){function r(t){return--s<0||!e(t,n)?(l=!0,!1):!0}function i(e){l||(e.isFile?e.file(function(e){l||r(e)}):e.isDirectory&&e.createReader().readEntries(function(e){if(!l)for(var t=0,n=e.length;n>t&&!l;t++)i(e[t])}))}for(var o=t.items,u=t.files,a=void 0,s=y,l=!1,c=0,f=u.length;f>c&&!l;c++){a=o&&o[c];var h=a&&a.webkitGetAsEntry&&a.webkitGetAsEntry();if(h&&h.isDirectory)i(h);else if(!r(u[c]))break}}}function a(){if("DataTransfer"in window&&"FileList"in window){var e=jQuery(document),t=p["default"].getInstance(),n=0,r=0,i=void 0,o=u(function(e,n){if(!n||n.length<1)return!1;e=new v["default"](t,e);var r=n.length;return n.some(function(t){var n=t.recieve(e);return n>0?!0:(0>n&&(r-=1),!1)})||r>0}),a=function(e){n=1,g.forEach(function(t){return t.start(e)})},s=function(e){var t=g.filter(function(t){return t.response(e)}).length>0,n=(e.originalEvent||e).dataTransfer;n&&(n.dropEffect=t?"copy":"none"),e.preventDefault()},l=function(e){n=0,r=0,g.forEach(function(t){return t.end(e)})},c=function(e){clearTimeout(i);var t="dragleave"===e.type;t||n||a(e),s(e),t&&(i=setTimeout(function(){return l(e)},100))},f=function(e){e.preventDefault(),clearTimeout(i),l(e);var t=g.filter(function(t){return t.contains(e.target)});if(!(t.length<1)){var n=(e.originalEvent||e).dataTransfer;try{if(n.getData("text/html"))return}catch(r){}o(n,t)}};e.on("dragenter dragover dragleave",c),e.on("drop",f)}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=u,r=!0}},c=n(2),f=r(c),h=n(9),p=r(h),d=n(12),v=r(d),y=100,m=function(e){function t(e){i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.areaElement=e}return o(t,e),s(t,[{key:"contains",value:function(e){return this.areaElement.contains(e)}},{key:"start",value:function(e,t){this.emit("start",e,t)}},{key:"response",value:function(e,t){return t=t&&this.contains(e.target),this.emit("response",e,t),t}},{key:"end",value:function(e){this.emit("end",e)}}]),t}(f["default"]),g=[],k=function(){function e(t){i(this,e),g.length<1&&a(),g.push(this),this.core=t,this.areas=[]}return s(e,[{key:"addArea",value:function(e){var t=this;return e=new m(e),this.areas.push(e),e.destroy=function(){e.removeAllListeners();var n=t.areas.indexOf(e);n>-1&&t.areas.splice(n,1)},e}},{key:"contains",value:function(e){return this.areas.some(function(t){return t.contains(e)})}},{key:"start",value:function(e){this.areas.forEach(function(t){return t.start(e)})}},{key:"response",value:function(e){return this.areas.map(function(t){return t.response(e)}).some(function(e){return e!==!1})}},{key:"recieve",value:function(e){var t=this.core.add(e);return t>0&&!this.core.isMultiple()?-1:t}},{key:"end",value:function(e){this.areas.forEach(function(t){return t.end(e)})}}]),e}();t["default"]=k,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=u,r=!0}},s=n(10),l=r(s),c=n(11),f=r(c),h=void 0,p=function(e){function t(){i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),u(t,[{key:"getAsDataUrl",value:function(e,t){var n=jQuery.Deferred(),r=new FileReader,i=void 0;r.onloadend=function(){r.readyState==FileReader.DONE?n.resolve(r.result):n.reject(),clearTimeout(i),r.onloadend=null},r.readAsDataURL(e);var o=function(){r&&r.abort(),r=null};t&&(i=setTimeout(o,t));var u=n.promise();return u.abort=o,u}},{key:"getTransport",value:function(){return this.transport||(this.transport=new f["default"](this)),this.transport}},{key:"canSlice",value:function(){return!!(Blob.prototype.slice||Blob.prototype.mozSlice||Blob.prototype.webkitSlice)}},{key:"slice",value:function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)}},{key:"md5",value:function(e){var t=jQuery.Deferred();if(!window.SparkMD5)return t.reject(),t.promise();var n=2097152,r=Math.ceil(e.size/n),i=0,o=new SparkMD5.ArrayBuffer,u=e.mozSlice||e.webkitSlice||e.slice,a=new FileReader,s=function(){if(a){var l=void 0,c=void 0;l=i*n,c=Math.min(l+n,e.size),a.onload=function(){o&&o.append(a.result)},a.onloadend=function(){a&&(a.readyState==FileReader.DONE?++i<r?setTimeout(s,1):setTimeout(function(){o&&t.resolve(o.end()),s=e=o=null},50):t.reject(),a.onloadend=a.onload=null)},a.readAsArrayBuffer(u.call(e,l,c))}};s();var l=t.promise();return l.abort=function(){a&&a.abort(),o=null,a=null},l}}],[{key:"getInstance",value:function(){return h||(h=new t),h}}]),t}(l["default"]);t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=u,r=!0}},s=n(2),l=r(s),c=n(3),f=r(c),h=n(5),p=function(e){function t(){i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),u(t,[{key:"md5",value:function(e){var t=jQuery.Deferred();return t.reject(),t.promise()}},{key:"getAsDataUrl",value:function(e,t){var n=jQuery.Deferred();return n.reject(),n.promise()}},{key:"getTransport",value:function(){return null}},{key:"getUploading",value:function(){return this.uploading||(this.uploading=new d(this)),this.uploading}},{key:"canSlice",value:function(){return!1}},{key:"slice",value:function(e){throw new Error("this runtime current not support slice")}},{key:"cancel",value:function(e){}}]),t}(l["default"]);t["default"]=p;var d=function(){function e(t){i(this,e),this.runtime=t}return u(e,[{key:"generate",value:function(e){var t=this,n=jQuery.Deferred(),r=e.getFile(),i=this.runtime,o=r.getSource(),u=r.size,a=e.getChunkSize(),s=e.isChunkEnable(),l=Math.max(e.getChunkProcessThreads(),1),c=0,f=0,h=[],p=function(){return h.reduce(function(e,t){return e+("pending"===t.state()?1:0)},0)},d=function(){for(var n=void 0,r=void 0,s=void 0;u>f&&p()<l;)c=f,f=Math.min(f+a,u),s=i.slice(o,c,f),r=e.createChunkRequest(h.length,s),n=t.slot(r,e.getChunkRetries()),n.progress(v).done(y).fail(g),h.push(n)},v=function(){var e=u-f,t=0;h.forEach(function(n){e+=n.total,t+=n.loaded}),n.notify({total:e,loaded:t})},y=function(e){s&&d(),f>=u&&h.every(function(e){return"resolved"===e.state()})&&n.resolve(e)},m=function(){h.forEach(function(e){return e.abort()})},g=function(e){n.reject(e),m()};if(s)d();else{f=u;var k=this.slot(e.createChunkRequest(0,o),0);k.progress(v).done(y).fail(g),h.push(k)}var b=n.promise();return b.abort=m,b}},{key:"slot",value:function t(e,n){var r=jQuery.Deferred(),i=this.runtime,o=e.getFile().getCore(),t=r.promise(),u=function(e){e.total&&(t.total=e.total),e.loaded&&(t.loaded=e.loaded),r.notify(e)},a=function(){var n,a,l;t.abort=function(){n&&n.abort(),a&&a.abort(),l&&l.abort()},t.total=e.getBlob().size,t.loaded=0,n=o.invoke(f["default"].CHUNK_UPLOAD_PREPARING,e),n.then(function(e){return a=i.getTransport().generate(e),a.progress(u),a}).then(function(t){return l=o.invoke(f["default"].CHUNK_UPLOAD_COMPLETING,e.createChunkResponse(t))}).done(r.resolve).fail(s)},s=function(e){e instanceof h.NetworkError&&n-->0?setTimeout(a,500):r.reject(e),t.abort()};return a(),t}}]),e}();e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,
r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),u=function(){function e(){r(this,e)}return i(e,[{key:"generate",value:function(e){var t=jQuery.Deferred(),n=new XMLHttpRequest,r=void 0,i=function(){n.onload=n.onerror=null,n.upload&&(n.upload.onprogress=null),r&&clearTimeout(r)},u=function(){i();try{n.abort()}catch(e){}},a=function(e){return i(),n.status||"error"!==e.type?0===n.status||304===n.status||n.status>=200&&n.status<300?t.resolve(n.responseText):t.reject(new o.NetworkError(n.status,n.statusText)):t.reject(new o.AbortError(e.message))};n.upload&&(n.upload.onprogress=function(e){return t.notify(e)}),n.onerror=a,n.onload=a;var s=e.getTimeout();s>0&&(r=setTimeout(function(){u(),t.reject(new o.TimeoutError("timeout:"+s))},s));try{!function(){n.open("POST",e.getUrl(),!0),e.isWithCredentials()&&(n.withCredentials=!0),e.getHeaders().forEach(function(e){return n.setRequestHeader(e.name,e.value)});var t=new FormData,r=e.getBlob();e.getParams().toArray().forEach(function(e){return t.append(e.name,e.value)}),t.append(e.getName(),r,r.name||"blob"),n.send(t)}()}catch(l){u(),t.reject(new o.AbortError(l.message))}var c=t.promise();return c.abort=u,c}}]),e}();t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(){return"FILE-"+(m++).toString(16).toUpperCase()}function a(e){var t=e.name&&g.exec(e.name);return t?t[1]:(t=e.type&&k.exec(e.type),t?t[1]:"")}function s(e){return["jpg","jpeg","png","gif","bmp","webp"].indexOf(e.toLowerCase())>-1?"image/"+("jpg"===e?"jpeg":e):null}Object.defineProperty(t,"__esModule",{value:!0});var l=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=u,r=!0}},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(2),h=r(f),p=n(3),d=r(p),v=n(4),y=r(v),m=0,g=/\.([^.]+)$/,k=/^image\/(jpg|jpeg|png|gif|bmp|webp)$/i,b=function(){function e(t,n){o(this,e),this.change(t,n)}return c(e,[{key:"change",value:function(e,t){this.total=e,this.loaded=t||0,this.percentage=this.loaded===this.total?100:Math.ceil(this.loaded/this.total*100)}},{key:"done",value:function(){this.change(this.total,this.total)}}]),e}();t["default"]=b;var E=function(e){function t(e,n,r){o(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.id=u(),this.name=n.name||r||this.id;var i=a(n).toLowerCase();i&&!g.test(this.name)&&(this.name+="."+i),this.ext=i,this.type=n.type||s(this.ext)||"application/octet-stream",this.lastModified=n.lastModified||+new Date,this.size=n.size||0,this.runtime=e,this.source=n,this.status=y["default"].INITED,this.progress=new b(this.size,0)}return i(t,e),c(t,[{key:"getCore",value:function(){return this.core}},{key:"setCore",value:function(e){this.core=e,this.setPropagationTarget(e)}},{key:"getRuntime",value:function(){return this.runtime}},{key:"isImage",value:function(){return k.test(this.type)}},{key:"setStatus",value:function(e){var t=this.status;t!==y["default"].CANCELLED&&e!==t&&(this.status=e,this.emit(d["default"].FILE_STATUS_CHANGE,e,t))}},{key:"getStatus",value:function(){return this.status}},{key:"getStatusName",value:function(){return this.status in v.StatusName?v.StatusName[this.status]:"unknow"}},{key:"getSource",value:function(){return this.source}},{key:"getAsDataUrl",value:function(e){return this._dataUrlPromise||(this._dataUrlPromise=this.runtime.getAsDataUrl(this.source,e)),this._dataUrlPromise}},{key:"md5",value:function(){return this._md5Promise||(this._md5Promise=this.runtime.md5(this.source)),this._md5Promise}},{key:"session",value:function n(){var e=this;if(this._sessionPromise)return this._sessionPromise;var n=jQuery.Deferred();return n.progress(function(t){e.setStatus(y["default"].PROGRESS),e.emit(d["default"].FILE_UPLOAD_PROGRESS,t)}).done(function(t){e.response=t,e._session=null,e._sessionPromise=null,e._flows=[],e.setStatus(y["default"].SUCCESS),e.emit(d["default"].FILE_UPLOAD_SUCCESS,t)}).fail(function(t){e._session=null,e._sessionPromise=null;for(var n=void 0;n=e._flows.shift();)n.abort();t instanceof Error&&(e.setStatus(y["default"].ERROR),e.emit(d["default"].FILE_UPLOAD_ERROR,t))}).always(function(){e.emit(d["default"].FILE_UPLOAD_COMPLETED,e.getStatus())}),this._flows=[],this._session=n,this._sessionPromise=n.promise(),this._sessionPromise}},{key:"prepare",value:function r(){var e=this;if(this.status!==y["default"].PENDING||!this.core)return!1;this.session(),this.setStatus(y["default"].PROGRESS),this.emit(d["default"].FILE_UPLOAD_START),this.request=this.core.createFileRequest(this);var r=this.core.invoke(d["default"].FILE_UPLOAD_PREPARING,this.request);return this._flows.push(r),r.then(function(t){e.emit(d["default"].FILE_UPLOAD_PREPARED,t);var n=e.runtime.getUploading().generate(t);return e._flows.push(n),n.progress(function(t){e.progress.change(t.total,t.loaded),e._session.notify(e.progress)}),n}).then(function(t){return e.complete(t)},this._session.reject),!0}},{key:"complete",value:function f(e){if(this.status===y["default"].PROGRESS){for(var t=void 0;t=this._flows.shift();)t.abort();this.progress.done(),this._session.notify(this.progress),e=this.request.createFileResponse(e),this.setStatus(y["default"].END),this.emit(d["default"].FILE_UPLOAD_END);var f=this.core.invoke(d["default"].FILE_UPLOAD_COMPLETING,e);this._flows.push(f),f.then(this._session.resolve,this._session.reject)}}},{key:"pending",value:function(){(this.status===y["default"].ERROR||this.status===y["default"].QUEUED)&&(this.progress.change(this.size,0),this.setStatus(y["default"].PENDING))}},{key:"abort",value:function(){this._session&&this._session.reject(),this._session=null,this._sessionPromise=null}},{key:"cancel",value:function(){this.setStatus(y["default"].CANCELLED),this.emit(d["default"].FILE_CANCEL),this.abort(),this.runtime.cancel(this.source),this._dataUrlPromise&&this._dataUrlPromise.abort(),this._md5Promise&&this._md5Promise.abort&&this._md5Promise.abort(),this.removeAllListeners()}},{key:"destroy",value:function(){this.cancel()}}]),t}(h["default"]);t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),a=r(u),s=n(9),l=r(s),c=n(12),f=r(c),h=function(){function e(t){i(this,e),this.core=t,this.runtime=l["default"].getInstance()}return o(e,[{key:"addArea",value:function(e){e=e.on?e:jQuery(e);var t=this.core,n=this.runtime,r=new a["default"],i=function(e){if(!e.isDefaultPrevented()){var i=(e.originalEvent||e).clipboardData||window.clipboardData,o=i.items,u=i.files;if(u||o){var a=void 0,s=void 0,l=void 0,c=void 0,h=void 0,p=void 0;if(u&&u.length)for(a=u.length>0,s=0,l=u.length;l>s&&(c=new f["default"](n,u[s]),a=1,p=t.add(c),!(0>p||p>0&&!t.isMultiple()));s++);else if(o&&o.length){var d=i.getData("text/plain");for(s=0,l=o.length;l>s&&!t.isLimit()&&(h=o[s],!("file"===h.kind&&(c=h.getAsFile())&&(c=new f["default"](n,c,d),d=null,a=1,p=t.add(c),0>p||p>0&&!t.isMultiple())));s++);}a&&(e.preventDefault(),e.stopPropagation(),r.emit("paste",i))}}};return"DataTransfer"in window&&"FileList"in window&&e.on("paste",i),r.destroy=function(){r.removeAllListeners(),e.off("paste",i)},r}}]),e}();t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),a=r(u),s=n(9),l=r(s),c=n(15),f=r(c),h=n(12),p=r(h),d="",v=function(){function e(t,n){var r=this;i(this,e);var o=jQuery("<label></label>");o.css({position:"fixed",opacity:0,left:-100,top:-100,width:50,height:50,display:"block",cursor:"pointer",background:"black",overflow:"hidden",zIndex:99999});var u=new f["default"](o,d,function(){return{accept:t.getAccept(),multiple:t.isMultiple()}});u.on("select",function(e){n(e.files,u),r.current&&r.current.emit("files",e.files,u)}),u.on("rollOut",function(){return r.hideOverlay()}),this.overlay=o.appendTo(document.body)}return o(e,[{key:"hideOverlay",value:function(){this.overlay.css({left:-100,top:-100,width:50,height:50}),this.current&&(this.current.emit("rollOut"),this.current=null)}},{key:"add",value:function(e){var t=this,n=this.overlay,r=new a["default"];return e=e.on?e:jQuery(e),e.on("mouseover.flashpicker",function(e){var i=e.currentTarget.getBoundingClientRect();n.css({left:i.left,top:i.top,width:i.right-i.left,height:i.bottom-i.top}),r.emit("rollOver"),t.current&&t.current!==r&&t.current.emit("rollOut"),t.current=r}),r.destroy=function(){t.current===r&&t.hideOverlay(),r.removeAllListeners(),e.off("mouseover.flashpicker")},r}}]),e}(),y=function(){function e(t,n){var r=this;i(this,e);var o=l["default"].getInstance();this._createInput=function(e){var i=jQuery(document.createElement("input"));i.attr("type","file"),i.css({position:"absolute",clip:"rect(1px 1px 1px 1px)"});var u=t.getAccept();u&&u.length>0&&(u=u.map(function(e){return e.mimeTypes||"."+e.extensions.join(",.")}),i.attr("accept",u.join(","))),t.isMultiple()&&i.attr("multiple","multiple"),i.on("change",function(t){n(t.target.files,o),i.remove(),r._createInput(e)}),e.html(i)}}return o(e,[{key:"add",value:function(e){var t=jQuery("<label></label>"),n=new a["default"];return t.css({position:"absolute",opacity:0,top:0,left:0,width:"100%",height:"100%",display:"inline-block",cursor:"pointer",background:"#fff",overflow:"hidden"}),this._createInput(t),t.appendTo(e),n.destroy=function(){n.removeAllListeners(),t.remove()},n}}]),e}(),m=function(){function e(t){i(this,e);var n=function(e,n){for(var r=0,i=e.length;i>r&&!(t.add(new p["default"](n,e[r]))<0);r++);};"DataTransfer"in window&&"FileList"in window?this.triggerCollection=new y(t,n):this.triggerCollection=new v(t,n)}return o(e,null,[{key:"setSWF",value:function(e){d=e}}]),o(e,[{key:"addArea",value:function(e){return this.triggerCollection.add(e)}}]),e}();t["default"]=m,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){var e=void 0;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}function a(e,t,n){try{e.CallFunction('<invoke name="'+t+'" returntype="javascript">'+__flash__argumentsToXML(n||[],0)+"</invoke>")}catch(r){throw"Call to "+t+" failed"}}function s(e,t){if(u()<11.4)throw"flash player is not available";var n=document.createElement("div"),r=e+(e.indexOf("?")>0?"&":"?")+"callInterface="+encodeURIComponent(t),i=['id="'+t+'-Picker"','type="application/x-shockwave-flash"','data="'+r+'"','width="100%" height="100%"','style="position:absolute;left:0;top:0;display:block;z-index:1;outline:0"'];return window.ActiveXObject&&i.push('classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"'),n.innerHTML="<object "+i.join(" ")+'><param name="movie" value="'+r+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',n.firstChild}function l(e){for(var t=!0;t;){var n=e;r=void 0,t=!1;var r=n+(y++).toString(16);if(!(r in window))return r;e=n,t=!0}}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=u,r=!0}},h=n(10),p=r(h),d=n(16),v=r(d),y=+new Date,m=function(e){function t(e,n,r){function o(){var t=e[0].offsetWidth,r=e[0].offsetHeight,i=void 0;return t&&r&&(i=s(n,u))?void e.append(a.flash=i):void setTimeout(o,1e3)}i(this,t),f(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var u=l("FlashRuntime");this.callInterface=u,window[u]=this,this.options=r;var a=this;o()}return o(t,e),c(t,[{key:"getOptions",value:function(){var e=this.options;return"function"==typeof e&&(e=e()),e}},{key:"getTransport",value:function(e,t,n){return new v["default"](this,e,t,n)}},{key:"send",value:function(e,t,n,r){a(this.flash,"exec",["send",e,t.id,n,r])}},{key:"abort",value:function(e){try{a(this.flash,"exec",["abort",e.id])}catch(t){}}},{key:"cancel",value:function(e){a(this.flash,"exec",["cancel",e.id])}},{key:"ping",value:function(){a(this.flash,"exec",["pang"])}},{key:"destroy",value:function(){delete window[this.callInterface]}}]),t}(p["default"]);t["default"]=m,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),u=function(){function e(t){r(this,e),this.flashRuntime=t}return i(e,[{key:"generate",value:function(e){var t=jQuery.Deferred(),n=this.flashRuntime,r=e.getBlob(),i=void 0,u=function(){n.off("uploadprogress",s),n.off("uploadcomplete",l),n.off("uploaderror",c),i&&clearTimeout(i)},a=function(){u(),n.abort(r.id)},s=function(e){e.id===r.id&&t.notify(e)},l=function(e){return e.id===r.id?(u(),304===e.status||e.status>=200&&e.status<300?(n.cancel(r),t.resolve(e.response)):t.reject(new o.NetworkError(e.status,e.response))):void 0},c=function(e){e.id===r.id&&(u(),t.reject(new o.AbortError(e.message)))};n.on("uploadprogress",s),n.on("uploadcomplete",l),n.on("uploaderror",c);var f=e.getTimeout();f>0&&(i=setTimeout(function(){a(),t.reject(new o.TimeoutError("timeout:"+f))},f));try{n.send(e.getName(),r,e.getUrl(),e.getParams().toString())}catch(h){a(),t.reject(new o.AbortError(h.message))}var p=t.promise();return p.abort=a,p}}]),e}();t["default"]=u,e.exports=t["default"]}])});
//# sourceMappingURL=uploadcore.js.map